---
title: "Testing `snow`"
author: "Michael Schmidt"
date: "8/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(snow)
library(tidyverse)
library(raster)
library(conflicted)

conflict_prefer("select", "dplyr")
conflict_prefer("extract", "raster")
```
## Let's try to 

I'll reread in the large raster that I removed above. 
```{r}
imagery_path<-"DATA/SanMiguel_West/Tiffs/SM_GypsumGapNW_0103_180611.tif"
r<-brick(imagery_path)
```

## First Try Snow
```{r}
z<-vector('list',4)
z<-1:4
system.time(lapply(z,function(x) Sys.sleep(1)))
cl<-makeCluster(6,type="SOCK")
system.time(clusterApply(cl, z,function(x) Sys.sleep(1)))
stopCluster(cl)
```

## No Do parallel
```{r}
rasterOptions(
  maxmemory = 5e+10,
  chunksize = 1e+08
)

start<-Sys.time()

scale_r<-r[[1:2]]%>%
  raster::scale(scale = FAlSE)

Sys.time()-start
```


```{r}
start<-Sys.time()
beginCluster(6, type="SOCK")
clusterR(r[[1:3]], scale(), args = list(center = TRUE, scale = FALSE))
endCluster()
Sys.time()-start
```

